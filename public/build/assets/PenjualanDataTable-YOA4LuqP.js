import{r as c,j as e}from"./app-DMT2vBXn.js";import{u as _,g as I,a as P,b as H,c as z,f as k}from"./index-kG6c7UDx.js";import{u as g,w as Y}from"./xlsx-D1NZSDnX.js";import{T as E,a as B,b as h,c as G,d as $,e as C,r as K}from"./table-QZwdL8Va.js";import{B as u}from"./button-Ltm5HKdw.js";import{I as L}from"./input-Bhz1a6y8.js";import{C as S}from"./calendar-DBJVIiVd.js";import{b as V}from"./utils-DszqnmLP.js";import{S as J}from"./search-CXvWl5jx.js";function te({data:x,columns:p}){const[j,f]=c.useState(""),[o,w]=c.useState(null),[i,b]=c.useState(null),[D,y]=c.useState(!1),m=c.useMemo(()=>{if(!o||!i)return x;const t=new Date(o.setHours(0,0,0,0)),a=new Date(i.setHours(23,59,59,999));return x.filter(n=>{const s=new Date(n.tgl_pesanan);return s>=t&&s<=a})},[x,o,i]),R=c.useMemo(()=>m.reduce((t,a)=>t+Number(a.total-a.jumlah_terbayar),0),[m]),M=t=>{const a=new Date;let n,s;switch(t){case"today":n=new Date(a.setHours(0,0,0,0)),s=new Date(a.setHours(23,59,59,999));break;case"thisMonth":n=new Date(a.getFullYear(),a.getMonth(),1),s=new Date(a.getFullYear(),a.getMonth()+1,0);break;case"thisYear":n=new Date(a.getFullYear(),0,1),s=new Date(a.getFullYear(),11,31);break;case"last7Days":s=new Date,n=new Date,n.setDate(s.getDate()-6);break;default:n=s=a}w(n),b(s),y(!1)},F=()=>{const t=m.map(l=>{var v,N,T;return{"Tanggal Pesanan":new Date(l.tgl_pesanan).toLocaleDateString("id-ID"),"Nomor Invoice":((N=(v=l.details)==null?void 0:v[0])==null?void 0:N.nomor_invoice)??`#${l.id}`,Pelanggan:((T=l.pelanggan)==null?void 0:T.nama_pelanggan)??"-","Total Tagihan":new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR"}).format(l.total),"Jumlah Terbayar":new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR"}).format(l.jumlah_terbayar),Status:l.status,Keterangan:l.keterangan??""}}),a=g.json_to_sheet(t),n=g.book_new();g.book_append_sheet(n,a,"Laporan Penjualan");const s=l=>l.toISOString().split("T")[0];let d="laporan_penjualan.xlsx";o&&i&&(d=`laporan_penjualan_${s(o)}_sampai_${s(i)}.xlsx`),Y(n,d)},r=_({data:m,columns:p,state:{globalFilter:j},onGlobalFilterChange:f,filterFns:{fuzzy:(t,a,n,s)=>{const d=K(t.getValue(a),n);return s({itemRank:d}),d.passed}},getCoreRowModel:z(),getFilteredRowModel:H(),getPaginationRowModel:P(),getSortedRowModel:I()});return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[["today","thisMonth","thisYear","last7Days"].map(t=>e.jsx(u,{variant:"outline",onClick:()=>M(t),children:{today:"Hari Ini",thisMonth:"Bulan Ini",thisYear:"Tahun Ini",last7Days:"7 Hari Terakhir"}[t]},t)),e.jsx(u,{variant:"outline",onClick:()=>y(!D),children:"Rentang Kustom"}),e.jsxs("div",{className:"relative ml-auto",children:[e.jsx(L,{placeholder:"Cari...",value:j,onChange:t=>f(t.target.value),className:"pl-10"}),e.jsx(J,{className:"absolute left-3 top-2.5 h-4 w-4 text-muted-foreground"})]}),e.jsx(u,{onClick:F,children:"Ekspor Excel"})]}),D&&e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsxs("div",{children:[e.jsx("span",{className:"block text-sm",children:"Dari:"}),e.jsx(S,{mode:"single",selected:o??void 0,onSelect:t=>w(t??null)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"block text-sm",children:"Sampai:"}),e.jsx(S,{mode:"single",selected:i??void 0,onSelect:t=>b(t??null)})]})]}),e.jsx("div",{className:"rounded border",children:e.jsxs(E,{children:[e.jsx(B,{children:r.getHeaderGroups().map(t=>e.jsx(h,{children:t.headers.map(a=>e.jsx(G,{children:k(a.column.columnDef.header,a.getContext())},a.id))},t.id))}),e.jsx($,{children:r.getRowModel().rows.length?r.getRowModel().rows.map(t=>e.jsx(h,{children:t.getVisibleCells().map(a=>e.jsx(C,{children:k(a.column.columnDef.cell,a.getContext())},a.id))},t.id)):e.jsx(h,{children:e.jsx(C,{colSpan:p.length,className:"text-center py-8",children:"Tidak ada data."})})})]})}),e.jsx("div",{className:"flex justify-end items-center space-x-4 py-4",children:e.jsxs("div",{className:"text-sm font-semibold",children:["Total Tagihan:"," ",e.jsx("span",{className:"text-green-600",children:V(R)})]})}),e.jsxs("div",{className:"flex items-center justify-end space-x-2 py-4",children:[e.jsx(u,{variant:"outline",size:"sm",onClick:()=>r.previousPage(),disabled:!r.getCanPreviousPage(),children:"Previous"}),e.jsx(u,{variant:"outline",size:"sm",onClick:()=>r.nextPage(),disabled:!r.getCanNextPage(),children:"Next"})]})]})}export{te as P};
