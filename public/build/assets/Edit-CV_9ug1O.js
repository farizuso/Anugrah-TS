import{r as d,X as E,G as F,j as e}from"./app-D8q50BTz.js";import{B as p,a as O}from"./button-BssZ3rn7.js";import{D as V,a as H,B as M,b as Q,c as z,d as A,e as G,f as K}from"./index-CER2iCBj.js";import{I as c}from"./input-BoM7r7s_.js";import{L as u}from"./label-uMeO6fTf.js";import{C as U}from"./calendar-BST7KOUR.js";import{P as X,a as $,b as J,C as b}from"./CommandCombobox-BMXICG25.js";import{S as W,a as Y,b as Z,c as ee,d as k}from"./select-DH_CGJQ4.js";import{C as ae}from"./calendar-CocnhpDY.js";import{f as re}from"./id-VFStllgx.js";import"./index-DtPFMwpl.js";import"./index-D6gRov8l.js";import"./index-CkrdwpRF.js";import"./index-C1RMllCk.js";import"./x-DR6B2ViQ.js";import"./createLucideIcon-B6Jghi0b.js";import"./iconBase-k2avexYK.js";import"./addMonths-MMVoVJT0.js";import"./chevron-right-ucfmWMns.js";import"./check-Dy7YIckw.js";import"./search-CF4IfSYU.js";import"./chevron-down-BI2PUopF.js";import"./index-B4Bgh4rz.js";import"./index-C9RTLTPM.js";const Re=({pembelianedit:l})=>{const[f,m]=d.useState(!1),{produks:v=[],suppliers:y=[]}=E().props,S=v.map(a=>({value:String(a.id),label:a.nama_produk})),h=y.map(a=>({value:String(a.id),label:a.nama_supplier})),{data:t,setData:n,put:C,processing:g,errors:x,reset:P}=F({tgl_pembelian:l.tgl_pembelian?new Date(l.tgl_pembelian):new Date,supplier_id:l.supplier.id?String(l.supplier.id):"",produk:l.details.map(a=>({produk_id:String(a.produk.id),harga:String(a.harga),quantity:String(a.quantity)})),keterangan:l.keterangan||"",total:l.total||0}),[te,se]=d.useState(h.find(a=>a.value===t.supplier_id)||null);d.useEffect(()=>{const a=t.produk.reduce((s,r)=>{const i=parseFloat(r.harga)||0,o=parseFloat(r.quantity)||0;return s+i*o},0);n("total",a)},[t.produk]);const _=(a,s)=>{const r=[...t.produk];r[a].produk_id=s?s.value:"",n("produk",r)},w=(a,s)=>{const r=[...t.produk];r[a].harga=s,n("produk",r)},N=(a,s)=>{const r=[...t.produk];r[a].quantity=s,n("produk",r)},D=()=>{n("produk",[...t.produk,{produk_id:"",harga:"",quantity:""}])},R=a=>{const s=[...t.produk];s.splice(a,1),n("produk",s)},T=a=>{a&&n("tgl_pembelian",a)},q=a=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR"}).format(a),I=a=>{const r=a.replace(/[^,\d]/g,"").split(",");let i=r[0].length%3,o=r[0].substr(0,i);const j=r[0].substr(i).match(/\d{3}/gi);return j&&(o+=(i?".":"")+j.join(".")),o=r[1]!==void 0?o+","+r[1]:o,o?"Rp "+o:""},L=a=>a.replace(/[^0-9]/g,""),B=a=>{a.preventDefault(),C(route("admin.laporanpembelian.update",l.id),{data:{...t,tgl_pembelian:t.tgl_pembelian.toISOString()},onSuccess:()=>{P(),m(!1)}})};return e.jsxs(V,{open:f,onOpenChange:m,children:[e.jsx(H,{asChild:!0,children:e.jsx(p,{variant:"outline_blue",size:"sm",type:"button",children:e.jsx(M,{})})}),e.jsxs(Q,{className:"sm:max-w-3xl",children:[e.jsxs(z,{children:[e.jsx(A,{children:"Edit Laporan Pembelian"}),e.jsx(G,{children:"Ubah informasi pembelian di bawah ini."})]}),e.jsxs("form",{onSubmit:B,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{children:"Tanggal Pembelian"}),e.jsxs(X,{children:[e.jsx($,{asChild:!0,children:e.jsxs(p,{variant:"outline",type:"button",className:O("w-full justify-start text-left font-normal",!t.tgl_pembelian&&"text-muted-foreground"),children:[t.tgl_pembelian?re(t.tgl_pembelian,"yyyy-MM-dd"):"Pilih Tanggal",e.jsx(ae,{className:"ml-auto h-4 w-4 opacity-50"})]})}),e.jsx(J,{className:"w-auto p-0",children:e.jsx(U,{mode:"single",selected:t.tgl_pembelian,onSelect:T,initialFocus:!0})})]})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(u,{children:"Nama Supplier"}),e.jsx(b,{options:h,value:t.supplier_id,onValueChange:a=>n("supplier_id",a),placeholder:"Pilih Supplier",searchPlaceholder:"Cari supplier..."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{children:"Produk"}),t.produk.map((a,s)=>e.jsxs("div",{className:"flex items-end gap-2",children:[e.jsx("div",{className:"w-full",children:e.jsx(b,{options:S,value:a.produk_id,onValueChange:r=>_(s,{value:r}),placeholder:"Pilih Produk",searchPlaceholder:"Cari produk..."})}),e.jsx(c,{type:"text",placeholder:"Harga",className:"w-32",value:I(a.harga),onChange:r=>w(s,L(r.target.value))}),e.jsx(c,{type:"number",className:"w-24",placeholder:"Qty",value:a.quantity,onChange:r=>N(s,r.target.value)}),e.jsx(p,{type:"button",variant:"destructive",onClick:()=>R(s),disabled:t.produk.length===1,children:"Hapus"})]},s)),e.jsx(p,{type:"button",variant:"secondary",onClick:D,children:"+ Tambah Produk"})]}),e.jsxs("div",{children:[e.jsx(u,{children:"Total"}),e.jsx(c,{value:q(t.total),disabled:!0})]}),e.jsxs("div",{children:[e.jsx(u,{className:"mb-1 block",children:"Keterangan Pembayaran"}),e.jsxs(W,{defaultValue:t.keterangan||"",onValueChange:a=>n("keterangan",a),children:[e.jsx(Y,{className:"w-[200px]",children:e.jsx(Z,{placeholder:""})}),e.jsxs(ee,{children:[e.jsx(k,{value:"Lunas",children:"Lunas"}),e.jsx(k,{value:"Belum Lunas",children:"Belum Lunas"})]})]}),x.keterangan&&e.jsx("p",{className:"text-sm text-red-500",children:x.keterangan})]}),e.jsx(K,{children:e.jsx(p,{type:"submit",disabled:g,children:g?"Menyimpan...":"Simpan Perubahan"})})]})]})]})};export{Re as default};
