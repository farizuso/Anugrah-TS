import{r as c,j as e}from"./app-C00ZbDyT.js";import{u as I,g as _,a as P,b as H,c as z,f as C}from"./index-CYjD6NV8.js";import{u as g,w as Y}from"./xlsx-D1NZSDnX.js";import{T as E,a as B,b as h,c as G,d as $,e as N,r as K}from"./table-vjZscMp2.js";import{B as u,f as L}from"./button-CH06GxxH.js";import{I as V}from"./input-D3A5GXnJ.js";import{C as S}from"./calendar-yzsJBQQN.js";import{S as J}from"./search-SdDbA7OI.js";function ae({data:x,columns:p}){const[f,j]=c.useState(""),[o,w]=c.useState(null),[i,D]=c.useState(null),[b,v]=c.useState(!1),m=c.useMemo(()=>{if(!o||!i)return x;const a=new Date(o.setHours(0,0,0,0)),t=new Date(i.setHours(23,59,59,999));return x.filter(n=>{const s=new Date(n.tgl_pesanan);return s>=a&&s<=t})},[x,o,i]),R=c.useMemo(()=>m.reduce((a,t)=>a+t.total,0),[m]),M=a=>{const t=new Date;let n,s;switch(a){case"today":n=new Date(t.setHours(0,0,0,0)),s=new Date(t.setHours(23,59,59,999));break;case"thisMonth":n=new Date(t.getFullYear(),t.getMonth(),1),s=new Date(t.getFullYear(),t.getMonth()+1,0);break;case"thisYear":n=new Date(t.getFullYear(),0,1),s=new Date(t.getFullYear(),11,31);break;case"last7Days":s=new Date,n=new Date,n.setDate(s.getDate()-6);break;default:n=s=t}w(n),D(s),v(!1)},F=()=>{const a=m.map(l=>{var y,T,k;return{"Tanggal Pesanan":new Date(l.tgl_pesanan).toLocaleDateString("id-ID"),"Nomor Invoice":((T=(y=l.details)==null?void 0:y[0])==null?void 0:T.nomor_invoice)??`#${l.id}`,Pelanggan:((k=l.pelanggan)==null?void 0:k.nama_pelanggan)??"-","Total Tagihan":new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR"}).format(l.total),"Jumlah Terbayar":new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR"}).format(l.jumlah_terbayar),Status:l.status,Keterangan:l.keterangan??""}}),t=g.json_to_sheet(a),n=g.book_new();g.book_append_sheet(n,t,"Laporan Penjualan");const s=l=>l.toISOString().split("T")[0];let d="laporan_penjualan.xlsx";o&&i&&(d=`laporan_penjualan_${s(o)}_sampai_${s(i)}.xlsx`),Y(n,d)},r=I({data:m,columns:p,state:{globalFilter:f},onGlobalFilterChange:j,filterFns:{fuzzy:(a,t,n,s)=>{const d=K(a.getValue(t),n);return s({itemRank:d}),d.passed}},getCoreRowModel:z(),getFilteredRowModel:H(),getPaginationRowModel:P(),getSortedRowModel:_()});return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[["today","thisMonth","thisYear","last7Days"].map(a=>e.jsx(u,{variant:"outline",onClick:()=>M(a),children:{today:"Hari Ini",thisMonth:"Bulan Ini",thisYear:"Tahun Ini",last7Days:"7 Hari Terakhir"}[a]},a)),e.jsx(u,{variant:"outline",onClick:()=>v(!b),children:"Rentang Kustom"}),e.jsxs("div",{className:"relative ml-auto",children:[e.jsx(V,{placeholder:"Cari...",value:f,onChange:a=>j(a.target.value),className:"pl-10"}),e.jsx(J,{className:"absolute left-3 top-2.5 h-4 w-4 text-muted-foreground"})]}),e.jsx(u,{onClick:F,children:"Ekspor Excel"})]}),b&&e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsxs("div",{children:[e.jsx("span",{className:"block text-sm",children:"Dari:"}),e.jsx(S,{mode:"single",selected:o??void 0,onSelect:a=>w(a??null)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"block text-sm",children:"Sampai:"}),e.jsx(S,{mode:"single",selected:i??void 0,onSelect:a=>D(a??null)})]})]}),e.jsx("div",{className:"rounded border",children:e.jsxs(E,{children:[e.jsx(B,{children:r.getHeaderGroups().map(a=>e.jsx(h,{children:a.headers.map(t=>e.jsx(G,{children:C(t.column.columnDef.header,t.getContext())},t.id))},a.id))}),e.jsx($,{children:r.getRowModel().rows.length?r.getRowModel().rows.map(a=>e.jsx(h,{children:a.getVisibleCells().map(t=>e.jsx(N,{children:C(t.column.columnDef.cell,t.getContext())},t.id))},a.id)):e.jsx(h,{children:e.jsx(N,{colSpan:p.length,className:"text-center py-8",children:"Tidak ada data."})})})]})}),e.jsx("div",{className:"flex justify-end items-center space-x-4 py-4",children:e.jsxs("div",{className:"text-sm font-semibold",children:["Total Tagihan:"," ",e.jsx("span",{className:"text-green-600",children:L(R)})]})}),e.jsxs("div",{className:"flex items-center justify-end space-x-2 py-4",children:[e.jsx(u,{variant:"outline",size:"sm",onClick:()=>r.previousPage(),disabled:!r.getCanPreviousPage(),children:"Previous"}),e.jsx(u,{variant:"outline",size:"sm",onClick:()=>r.nextPage(),disabled:!r.getCanNextPage(),children:"Next"})]})]})}export{ae as P};
