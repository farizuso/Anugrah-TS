import{X as G,G as H,r as x,j as a}from"./app-C7EHMIf6.js";import{B as c,a as L}from"./button-MW_7tLPj.js";import{c as O,C as A,a as E,b as V,d as B,e as Q}from"./card-CwObyTy9.js";import{I as p}from"./input-CaKKR14z.js";import{L as m}from"./label-CC-KLTxJ.js";import{T as J,a as X,b,c as C}from"./tabs-C3_Xls3y.js";import{A as $}from"./AdminLayout-B2z_6eQy.js";import{PesananColumns as z}from"./PesananColumn-COyVUEpo.js";import{P as K,a as U,b as W,C as P}from"./CommandCombobox-DNmc_hRP.js";import{C as Y}from"./calendar-CcwVUwhJ.js";import{D as Z}from"./DataTable-BB-l7oSN.js";import{C as aa}from"./calendar-Brxo0Imy.js";import{f as k}from"./id-VFStllgx.js";import"./index-uqKLX7zh.js";import"./index-D7FeLRqf.js";import"./index-Cn2QRNn1.js";import"./index-CPL6L-RE.js";import"./index-8UpiC1l3.js";import"./chevron-right-C7y_bAMJ.js";import"./check-DRdj--cP.js";import"./createLucideIcon-BUg38ilO.js";import"./x-DQa3wFi_.js";import"./index-DMdbELf3.js";import"./checkbox-D_BuBzLk.js";import"./index-Dn53Hcqn.js";import"./Delete-BskuVrXq.js";import"./index-BwGdZdgE.js";import"./iconBase-UFW9020L.js";import"./Edit-vI3HwhtU.js";import"./index-Did_tOGL.js";import"./addMonths-MMVoVJT0.js";import"./search-D8nYubSD.js";import"./chevron-down-Bl-bS0gw.js";import"./arrow-up-down-BvrWENfu.js";import"./eye-DtskiFeY.js";import"./index-BCuqL2Jy.js";import"./table-BqEwX9Rf.js";const Oa=({posts:_,produks:h,pelanggans:w})=>{const g=G().props.auth,{data:n,setData:o,post:S,processing:y,reset:N}=H({tgl_pesanan:k(new Date,"yyyy-MM-dd"),pelanggan_id:"",produk:[{produk_id:"",quantity:"",harga:0,tipe_item:"jual",durasi:0}],total:0}),[j,u]=x.useState([]),T=w.map(e=>({value:String(e.id),label:e.nama_pelanggan})),D=h.map(e=>({value:String(e.id),label:e.nama_produk})),v=e=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR"}).format(e),q=(e,s)=>{const r=h.find(l=>String(l.id)===(s==null?void 0:s.value)),t=[...n.produk];if(t[e].produk_id=(s==null?void 0:s.value)||"",t[e].tipe_item==="sewa"&&(r==null?void 0:r.kategori)==="gas"){const l=(r==null?void 0:r.harga_jual)||0,d=1e5*(t[e].durasi||1);t[e].harga=l+d,t[e].durasi=1}else t[e].harga=(r==null?void 0:r.harga_jual)||0,t[e].durasi=0;o("produk",t);const i=[...j];i[e]=s,u(i)},I=(e,s)=>{const r=[...n.produk];r[e].quantity=s,o("produk",r)},M=()=>{o("produk",[...n.produk,{produk_id:"",quantity:"",harga:0,tipe_item:"jual",durasi:0}]),u([...j,null])},R=e=>{const s=[...n.produk];s.splice(e,1),o("produk",s);const r=[...j];r.splice(e,1),u(r)},F=e=>{e.preventDefault(),S(route("staffpenjualan.pesanan.store"),{data:n,preserveScroll:!0,onSuccess:()=>{N(),u([null]),o("produk",[{produk_id:"",quantity:"",harga:0,tipe_item:"jual",durasi:0}])}})};return x.useEffect(()=>{const e=n.produk.reduce((s,r)=>{var l;const t=parseFloat(r.quantity)||0,i=parseFloat(((l=r.harga)==null?void 0:l.toString())||"0");return s+i*t},0);o("total",e)},[n.produk]),a.jsx($,{children:a.jsxs(J,{defaultValue:"datatable",className:"w-full",children:[a.jsxs(X,{className:"grid w-full grid-cols-2",children:[a.jsx(b,{value:"datatable",children:"Data Table"}),a.jsx(b,{value:"form",children:"Tambah Data"})]}),a.jsx(C,{value:"datatable",children:(g==null?void 0:g.user)&&a.jsx(Z,{columns:z,data:_})}),a.jsx(C,{value:"form",children:a.jsx(O,{children:a.jsxs("form",{onSubmit:F,children:[a.jsxs(A,{children:[a.jsx(E,{children:"Tambah Pesanan"}),a.jsx(V,{children:"Masukkan data Pesanan."})]}),a.jsxs(B,{className:"space-y-4",children:[a.jsxs("div",{className:"space-y-1",children:[a.jsx(m,{children:"Tanggal Pemesanan"}),a.jsxs(K,{children:[a.jsx(U,{asChild:!0,children:a.jsxs(c,{variant:"outline",className:L("w-full justify-start text-left font-normal",!n.tgl_pesanan&&"text-muted-foreground"),children:[n.tgl_pesanan??"Pilih Tanggal",a.jsx(aa,{className:"ml-auto h-4 w-4 opacity-50"})]})}),a.jsx(W,{className:"w-auto p-0",children:a.jsx(Y,{mode:"single",selected:n.tgl_pesanan?new Date(n.tgl_pesanan):void 0,onSelect:e=>{if(e){const s=k(e,"yyyy-MM-dd");o("tgl_pesanan",s)}}})})]})]}),a.jsxs("div",{className:"flex flex-col gap-2",children:[a.jsx(m,{children:"Nama Pelanggan"}),a.jsx(P,{options:T,value:n.pelanggan_id,onValueChange:e=>o("pelanggan_id",e),placeholder:"Pilih Pelanggan",searchPlaceholder:"Cari Pelanggan..."})]}),a.jsxs("div",{children:[a.jsx(m,{children:"Produk"}),n.produk.map((e,s)=>{const r=h.find(t=>String(t.id)===e.produk_id);return a.jsxs("div",{className:"flex gap-2 items-center mb-2",children:[a.jsx(P,{options:D,value:e.produk_id,onValueChange:t=>q(s,{value:t}),placeholder:"Pilih Produk",searchPlaceholder:"Cari produk..."}),a.jsxs("select",{className:"border rounded px-2 py-1",value:e.tipe_item,onChange:t=>{const i=t.target.value,l=[...n.produk];if(l[s].tipe_item=i,i==="sewa"&&(r==null?void 0:r.kategori)==="gas"){const d=(r==null?void 0:r.harga_jual)||0,f=1e5*(l[s].durasi||1);l[s].harga=d+f,l[s].durasi=1}else l[s].harga=(r==null?void 0:r.harga_jual)||0,l[s].durasi=0;o("produk",l)},children:[a.jsx("option",{value:"jual",children:"Jual"}),a.jsx("option",{value:"sewa",children:"Sewa"})]}),e.tipe_item==="sewa"&&a.jsx(p,{type:"number",placeholder:"Durasi (bln)",className:"w-28",value:e.durasi,onChange:t=>{const i=parseInt(t.target.value)||1,l=[...n.produk];l[s].durasi=i;const d=(r==null?void 0:r.harga_jual)||0,f=1e5*i;l[s].harga=d+f,o("produk",l)}}),a.jsx(p,{type:"text",placeholder:"Harga",className:"w-32",value:v(Number(e.harga)),readOnly:!0}),a.jsx(p,{type:"number",placeholder:"Qty",className:"w-24",value:e.quantity,onChange:t=>I(s,t.target.value)}),a.jsx(c,{variant:"destructive",type:"button",onClick:()=>R(s),disabled:n.produk.length===1,children:"Hapus"})]},s)}),a.jsx(c,{type:"button",variant:"secondary",onClick:M,children:"+ Tambah Produk"}),a.jsxs("div",{className:"space-y-1 mt-4",children:[a.jsx(m,{children:"Total"}),a.jsx(p,{type:"text",value:v(n.total),readOnly:!0})]})]})]}),a.jsx(Q,{children:a.jsx(c,{type:"submit",disabled:y,children:y?"Menyimpan...":"Simpan Pesanan"})})]})})})]})})};export{Oa as default};
