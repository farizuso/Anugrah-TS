import{X as G,G as I,r as v,j as a}from"./app-BhOsPJ8v.js";import{B as c,a as L,f as y}from"./button-_M8VdPMJ.js";import{c as O,C as A,a as E,b as Q,d as V,e as B}from"./card-2rcK8Uzh.js";import{I as p}from"./input-DfoBfsiM.js";import{L as m}from"./label-BcpOi1vL.js";import{T as J,a as X,b as x,c as C}from"./tabs-FXOwAsi1.js";import{A as $}from"./AdminLayout-Bh7w6y9q.js";import{PesananColumns as z}from"./PesananColumn-B3CbcngL.js";import{P as K,a as U,b as W,C as P}from"./CommandCombobox-CuLhOo98.js";import{C as Y}from"./calendar-DS0x6W4h.js";import{D as Z}from"./DataTable-CrPfqC1r.js";import{C as aa}from"./calendar-ByDWVMKc.js";import{f as _}from"./id-VFStllgx.js";import"./index-Cq-KRWnH.js";import"./index-BbUQSan3.js";import"./index-Decy9dsL.js";import"./index-BZT5xH-c.js";import"./index-oDVHq9e5.js";import"./chevron-right-D-nFaWsJ.js";import"./check-CUHmrBqO.js";import"./createLucideIcon-Dh0RT_dH.js";import"./x-CFT6KP3J.js";import"./index-CQZJ7SKH.js";import"./checkbox-DQ0msOBm.js";import"./index-D60drR72.js";import"./Delete-Dv9TIU_1.js";import"./index-BWgpldsQ.js";import"./iconBase-CJ4l1MQW.js";import"./Edit-s3CvroMx.js";import"./index-BVAqS8KA.js";import"./addMonths-MMVoVJT0.js";import"./search-DqVxRVeT.js";import"./chevron-down-DXh7kGer.js";import"./arrow-up-down-DgkYT2DH.js";import"./eye-CoCYT0Jz.js";import"./index-Cn1hTGmm.js";import"./table-BopenJfx.js";const Oa=({posts:k,produks:h,pelanggans:w})=>{const g=G().props.auth,{data:l,setData:i,post:N,processing:b,reset:S}=I({tgl_pesanan:_(new Date,"yyyy-MM-dd"),pelanggan_id:"",produk:[{produk_id:"",quantity:0,harga:0,tipe_item:"jual",durasi:0}],total:0}),[j,u]=v.useState([]),T=w.map(e=>({value:String(e.id),label:e.nama_pelanggan})),D=h.map(e=>({value:String(e.id),label:e.nama_produk})),q=(e,r)=>{const s=h.find(n=>String(n.id)===(r==null?void 0:r.value)),t=[...l.produk];if(t[e].produk_id=(r==null?void 0:r.value)||"",t[e].tipe_item==="sewa"&&(s==null?void 0:s.kategori)==="gas"){const n=(s==null?void 0:s.harga_jual)||0,d=1e5*(t[e].durasi||1);t[e].harga=n+d,t[e].durasi=1}else t[e].harga=(s==null?void 0:s.harga_jual)||0,t[e].durasi=0;i("produk",t);const o=[...j];o[e]=r,u(o)},M=(e,r)=>{const s=parseInt(r,10),t=[...l.produk];t[e].quantity=Number.isFinite(s)?s:0,i("produk",t)},H=()=>{i("produk",[...l.produk,{produk_id:"",quantity:0,harga:0,tipe_item:"jual",durasi:0}]),u([...j,null])},R=e=>{const r=[...l.produk];r.splice(e,1),i("produk",r);const s=[...j];s.splice(e,1),u(s)},F=e=>{e.preventDefault(),N(route("staffpenjualan.pesanan.store"),{data:l,preserveScroll:!0,onSuccess:()=>{S(),u([null]),i("produk",[{produk_id:"",quantity:0,harga:0,tipe_item:"jual",durasi:0}])}})};return v.useEffect(()=>{const e=l.produk.reduce((r,s)=>{const t=s.quantity,o=Number(s.harga),n=Number.isFinite(t)?t:0,d=Number.isFinite(o)?o:0;return r+d*n},0);i("total",e)},[l.produk]),a.jsx($,{children:a.jsxs(J,{defaultValue:"datatable",className:"w-full",children:[a.jsxs(X,{className:"grid w-full grid-cols-2",children:[a.jsx(x,{value:"datatable",children:"Data Table"}),a.jsx(x,{value:"form",children:"Tambah Data"})]}),a.jsx(C,{value:"datatable",children:(g==null?void 0:g.user)&&a.jsx(Z,{columns:z,data:k})}),a.jsx(C,{value:"form",children:a.jsx(O,{children:a.jsxs("form",{onSubmit:F,children:[a.jsxs(A,{children:[a.jsx(E,{children:"Tambah Pesanan"}),a.jsx(Q,{children:"Masukkan data Pesanan."})]}),a.jsxs(V,{className:"space-y-4",children:[a.jsxs("div",{className:"space-y-1",children:[a.jsx(m,{children:"Tanggal Pemesanan"}),a.jsxs(K,{children:[a.jsx(U,{asChild:!0,children:a.jsxs(c,{variant:"outline",className:L("w-full justify-start text-left font-normal",!l.tgl_pesanan&&"text-muted-foreground"),children:[l.tgl_pesanan??"Pilih Tanggal",a.jsx(aa,{className:"ml-auto h-4 w-4 opacity-50"})]})}),a.jsx(W,{className:"w-auto p-0",children:a.jsx(Y,{mode:"single",selected:l.tgl_pesanan?new Date(l.tgl_pesanan):void 0,onSelect:e=>{if(e){const r=_(e,"yyyy-MM-dd");i("tgl_pesanan",r)}}})})]})]}),a.jsxs("div",{className:"flex flex-col gap-2",children:[a.jsx(m,{children:"Nama Pelanggan"}),a.jsx(P,{options:T,value:l.pelanggan_id,onValueChange:e=>i("pelanggan_id",e),placeholder:"Pilih Pelanggan",searchPlaceholder:"Cari Pelanggan..."})]}),a.jsxs("div",{children:[a.jsx(m,{children:"Produk"}),l.produk.map((e,r)=>{const s=h.find(t=>String(t.id)===e.produk_id);return a.jsxs("div",{className:"flex gap-2 items-center mb-2",children:[a.jsx(P,{options:D,value:e.produk_id,onValueChange:t=>q(r,{value:t}),placeholder:"Pilih Produk",searchPlaceholder:"Cari produk..."}),a.jsxs("select",{className:"border rounded px-2 py-1",value:e.tipe_item,onChange:t=>{const o=t.target.value,n=[...l.produk];if(n[r].tipe_item=o,o==="sewa"&&(s==null?void 0:s.kategori)==="gas"){const d=(s==null?void 0:s.harga_jual)||0,f=1e5*(n[r].durasi||1);n[r].harga=d+f,n[r].durasi=1}else n[r].harga=(s==null?void 0:s.harga_jual)||0,n[r].durasi=0;i("produk",n)},children:[a.jsx("option",{value:"jual",children:"Jual"}),a.jsx("option",{value:"sewa",children:"Sewa"})]}),e.tipe_item==="sewa"&&a.jsx(p,{type:"number",placeholder:"Durasi (bln)",className:"w-28",value:e.durasi,onChange:t=>{const o=parseInt(t.target.value)||1,n=[...l.produk];n[r].durasi=o;const d=s!=null&&s.harga_jual?Number(s.harga_jual):0,f=1e5*o;n[r].harga=d+f,i("produk",n)}}),a.jsx(p,{type:"text",placeholder:"Harga",className:"w-32",value:y(e.harga),readOnly:!0}),a.jsx(p,{type:"number",placeholder:"Qty",className:"w-24",value:e.quantity,onChange:t=>M(r,t.target.value)}),a.jsx(c,{variant:"destructive",type:"button",onClick:()=>R(r),disabled:l.produk.length===1,children:"Hapus"})]},r)}),a.jsx(c,{type:"button",variant:"secondary",onClick:H,children:"+ Tambah Produk"}),a.jsxs("div",{className:"space-y-1 mt-4",children:[a.jsx(m,{children:"Total"}),a.jsx(p,{type:"text",value:y(l.total),readOnly:!0})]})]})]}),a.jsx(B,{children:a.jsx(c,{type:"submit",disabled:b,children:b?"Menyimpan...":"Simpan Pesanan"})})]})})})]})})};export{Oa as default};
