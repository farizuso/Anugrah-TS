import{X as I,G as L,r as v,j as a}from"./app-BdUr3u5P.js";import{B as m,a as O,f as y}from"./button-Ci0wHoJq.js";import{c as A,C as B,a as E,b as Q,d as V,e as J}from"./card-CwyT2rwQ.js";import{I as h}from"./input-BxJja2d8.js";import{L as c}from"./label-BamHE75r.js";import{T as X,a as $,b as x,c as _}from"./tabs-DqlHKEHI.js";import{A as z}from"./AdminLayout-CEKOMizm.js";import{PesananColumns as K}from"./PesananColumn-Dw5OGoqs.js";import{P as U,a as W,b as Y,C}from"./CommandCombobox-BIivlh6O.js";import{C as Z}from"./calendar-DMNa53gJ.js";import{D as aa}from"./DataTable-Dcyo6k_-.js";import{C as ea}from"./calendar-CKEieCTb.js";import{f as P}from"./id-VFStllgx.js";import"./index-dg-iMJ30.js";import"./index-BD_8mv9u.js";import"./index-CDuUHnHN.js";import"./index-C2OEQ7fR.js";import"./index-FDR9JoKf.js";import"./chevron-right-t0vtBpqB.js";import"./check-Cfd4ZIxJ.js";import"./createLucideIcon-sxw0EeDO.js";import"./x-DTvo31mV.js";import"./index-Drf6oUjb.js";import"./checkbox-BExit_ha.js";import"./index-CMg3D6qx.js";import"./Delete-DUp6pJwH.js";import"./index-BMWbWbIq.js";import"./iconBase-4IfV-yEE.js";import"./Edit-DnmyabV1.js";import"./index-BHzojCSW.js";import"./addMonths-MMVoVJT0.js";import"./search-D4yp-8zN.js";import"./chevron-down-CXS5UxTc.js";import"./arrow-up-down-B515nXjp.js";import"./eye-entpZNuV.js";import"./index-CkSSftAv.js";import"./table-CGR8CVr9.js";const Aa=({posts:k,produks:g,pelanggans:w})=>{const j=I().props.auth,{data:n,setData:i,post:N,processing:b,reset:S}=L({tgl_pesanan:P(new Date,"yyyy-MM-dd"),pelanggan_id:"",produk:[{produk_id:"",quantity:0,harga:0,tipe_item:"jual",durasi:0}],total:0}),[f,p]=v.useState([]),T=w.map(e=>({value:String(e.id),label:e.nama_pelanggan})),D=g.map(e=>({value:String(e.id),label:e.nama_produk})),q=(e,s)=>{const r=g.find(l=>String(l.id)===(s==null?void 0:s.value)),t=[...n.produk];if(t[e].produk_id=(s==null?void 0:s.value)||"",t[e].tipe_item==="sewa"&&(r==null?void 0:r.kategori)==="gas"){const l=r!=null&&r.harga_jual?Number(r.harga_jual):0,u=t[e].durasi&&t[e].durasi>0?t[e].durasi:1,d=1e5*u;t[e].harga=l+d,t[e].durasi=u}else{const l=r!=null&&r.harga_jual?Number(r.harga_jual):0;t[e].harga=l,t[e].durasi=0}i("produk",t);const o=[...f];o[e]=s,p(o)},G=(e,s)=>{const r=parseInt(s,10),t=[...n.produk];t[e].quantity=Number.isFinite(r)?r:0,i("produk",t)},M=()=>{i("produk",[...n.produk,{produk_id:"",quantity:0,harga:0,tipe_item:"jual",durasi:0}]),p([...f,null])},H=e=>{const s=[...n.produk];s.splice(e,1),i("produk",s);const r=[...f];r.splice(e,1),p(r)},R=e=>{e.preventDefault(),N(route("staffpenjualan.pesanan.store"),{data:n,preserveScroll:!0,onSuccess:()=>{S(),p([null]),i("produk",[{produk_id:"",quantity:0,harga:0,tipe_item:"jual",durasi:0}])}})};return v.useEffect(()=>{const e=n.produk.reduce((s,r)=>{const t=r.quantity,o=Number(r.harga),l=Number.isFinite(t)?t:0,u=Number.isFinite(o)?o:0;return s+u*l},0);i("total",e)},[n.produk]),a.jsx(z,{children:a.jsxs(X,{defaultValue:"datatable",className:"w-full",children:[a.jsxs($,{className:"grid w-full grid-cols-2",children:[a.jsx(x,{value:"datatable",children:"Data Table"}),a.jsx(x,{value:"form",children:"Tambah Data"})]}),a.jsx(_,{value:"datatable",children:(j==null?void 0:j.user)&&a.jsx(aa,{columns:K,data:k})}),a.jsx(_,{value:"form",children:a.jsx(A,{children:a.jsxs("form",{onSubmit:R,children:[a.jsxs(B,{children:[a.jsx(E,{children:"Tambah Pesanan"}),a.jsx(Q,{children:"Masukkan data Pesanan."})]}),a.jsxs(V,{className:"space-y-4",children:[a.jsxs("div",{className:"space-y-1",children:[a.jsx(c,{children:"Tanggal Pemesanan"}),a.jsxs(U,{children:[a.jsx(W,{asChild:!0,children:a.jsxs(m,{variant:"outline",className:O("w-full justify-start text-left font-normal",!n.tgl_pesanan&&"text-muted-foreground"),children:[n.tgl_pesanan??"Pilih Tanggal",a.jsx(ea,{className:"ml-auto h-4 w-4 opacity-50"})]})}),a.jsx(Y,{className:"w-auto p-0",children:a.jsx(Z,{mode:"single",selected:n.tgl_pesanan?new Date(n.tgl_pesanan):void 0,onSelect:e=>{if(e){const s=P(e,"yyyy-MM-dd");i("tgl_pesanan",s)}}})})]})]}),a.jsxs("div",{className:"flex flex-col gap-2",children:[a.jsx(c,{children:"Nama Pelanggan"}),a.jsx(C,{options:T,value:n.pelanggan_id,onValueChange:e=>i("pelanggan_id",e),placeholder:"Pilih Pelanggan",searchPlaceholder:"Cari Pelanggan..."})]}),a.jsxs("div",{children:[a.jsx(c,{children:"Produk"}),n.produk.map((e,s)=>{const r=g.find(t=>String(t.id)===e.produk_id);return a.jsxs("div",{className:"flex gap-2 items-center mb-2",children:[a.jsx(C,{options:D,value:e.produk_id,onValueChange:t=>q(s,{value:t}),placeholder:"Pilih Produk",searchPlaceholder:"Cari produk..."}),a.jsxs("select",{className:"border rounded px-2 py-1",value:e.tipe_item,onChange:t=>{const o=t.target.value,l=[...n.produk];if(l[s].tipe_item=o,o==="sewa"&&(r==null?void 0:r.kategori)==="gas"){const u=r!=null&&r.harga_jual?Number(r.harga_jual):0,d=l[s].durasi&&l[s].durasi>0?l[s].durasi:1,F=1e5*d;l[s].harga=u+F,l[s].durasi=d}else{const u=r!=null&&r.harga_jual?Number(r.harga_jual):0;l[s].harga=u,l[s].durasi=0}i("produk",l)},children:[a.jsx("option",{value:"jual",children:"Jual"}),a.jsx("option",{value:"sewa",children:"Sewa"})]}),e.tipe_item==="sewa"&&a.jsxs("div",{className:"flex gap-1 items-center",children:[a.jsx(h,{type:"number",placeholder:"Durasi (bln)",className:"w-28",value:e.durasi,onChange:t=>{const o=parseInt(t.target.value)||1,l=[...n.produk];l[s].durasi=o;const u=r!=null&&r.harga_jual?Number(r.harga_jual):0,d=1e5*o;l[s].harga=u+d,i("produk",l)}}),a.jsx(c,{children:"Bulan"})]}),a.jsx(h,{type:"text",placeholder:"Harga",className:"w-32",value:y(e.harga),readOnly:!0}),a.jsx(h,{type:"number",placeholder:"Qty",className:"w-24",value:e.quantity,onChange:t=>G(s,t.target.value)}),a.jsx(m,{variant:"destructive",type:"button",onClick:()=>H(s),disabled:n.produk.length===1,children:"Hapus"})]},s)}),a.jsx(m,{type:"button",variant:"secondary",onClick:M,children:"+ Tambah Produk"}),a.jsxs("div",{className:"space-y-1 mt-4",children:[a.jsx(c,{children:"Total"}),a.jsx(h,{type:"text",value:y(n.total),readOnly:!0})]})]})]}),a.jsx(J,{children:a.jsx(m,{type:"submit",disabled:b,children:b?"Menyimpan...":"Simpan Pesanan"})})]})})})]})})};export{Aa as default};
