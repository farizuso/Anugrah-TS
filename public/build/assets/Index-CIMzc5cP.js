import{X as J,G as K,r as h,j as a}from"./app-DMT2vBXn.js";import{B as x}from"./button-Ltm5HKdw.js";import{c as W,C as X,a as Z,b as z,d as U,e as Y}from"./card-9vL8EJSB.js";import{I as i}from"./input-Bhz1a6y8.js";import{L as o}from"./label-DOXTW0xs.js";import{T as $,a as aa,b as k,c as f}from"./tabs-okQi88fl.js";import{A as ea}from"./AdminLayout-DCntX3WR.js";import{PembelianColumns as ra}from"./PembelianColumn-B3LMw3ai.js";import{L as ta}from"./LaporanDataTable-B_1BpmoU.js";import{S as v,a as C,b as T,c as P,d as m}from"./select-B8vrGt7z.js";import{C as _}from"./CommandCombobox-BihZWNoV.js";import{d as sa}from"./utils-DszqnmLP.js";import{f as na}from"./format-E3oY-FzV.js";import"./index-B7WmghTc.js";import"./index-CPhx5Ux5.js";import"./index-D93gU69Y.js";import"./index-sYTWR9hF.js";import"./index-MW_iqSYy.js";import"./chevron-right-DFFaW-z_.js";import"./check-_gL9h_k7.js";import"./createLucideIcon-KWJKGgr8.js";import"./x-CFTlkhW7.js";import"./index-B3ooS7C_.js";import"./checkbox-wwbxOqxS.js";import"./index-CqMViL_E.js";import"./Delete-D4CajBtp.js";import"./index-ufNaQBA4.js";import"./iconBase-DIa76aja.js";import"./Edit-TmHa64uP.js";import"./index-Di2eGbQX.js";import"./calendar-DBJVIiVd.js";import"./addMonths-gSIyaRnd.js";import"./calendar-BM3KtSxw.js";import"./arrow-up-down-DoxsXHKV.js";import"./index-kG6c7UDx.js";import"./xlsx-D1NZSDnX.js";import"./table-QZwdL8Va.js";import"./search-CXvWl5jx.js";import"./chevron-down-CaYKfP80.js";const Xa=({posts:N,produks:S,suppliers:w})=>{const c=J().props.auth,{data:s,setData:n,post:D,processing:g,errors:d,reset:L}=K({tgl_pembelian:new Date,supplier_id:"",produk:[{produk_id:"",harga:"",quantity:""}],total:0,keterangan:"",ppn:0,grand_total:0,metode_pembayaran:"",status:""}),H=e=>{e.preventDefault();const r=sa(s.tgl_pembelian,"Asia/Jakarta","yyyy-MM-dd HH:mm:ss");D(route("admin.laporanpembelian.store"),{data:{...s,tgl_pembelian:r},onSuccess:()=>{L(),n({tgl_pembelian:new Date,supplier_id:"",produk:[{produk_id:"",harga:"",quantity:""}],total:0,ppn:0,grand_total:0,keterangan:"",metode_pembayaran:"",status:""}),R(null),b([null])}})},[oa,R]=h.useState(null),[I,b]=h.useState([null]),q=(e,r)=>{const t=[...s.produk];t[e].produk_id=(r==null?void 0:r.value)||"",n("produk",t)},M=(e,r)=>{const t=[...s.produk];t[e].harga=r,n("produk",t)},V=(e,r)=>{const t=[...s.produk];t[e].quantity=r,n("produk",t)},O=()=>{n("produk",[...s.produk,{produk_id:"",harga:"",quantity:""}]),b([...I,null])},A=e=>{const r=[...s.produk];r.splice(e,1),n("produk",r)},B=S.map(e=>({value:String(e.id),label:e.nama_produk})),F=w.map(e=>({value:String(e.id),label:e.nama_supplier})),u=e=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR"}).format(e),E=e=>{const t=e.replace(/[^,\d]/g,"").split(",");let p=t[0].length%3,l=t[0].substr(0,p);const y=t[0].substr(p).match(/\d{3}/gi);return y&&(l+=(p?".":"")+y.join(".")),l=t[1]!==void 0?l+","+t[1]:l,l?"Rp "+l:""},G=e=>e.replace(/[^0-9]/g,"");h.useEffect(()=>{const e=s.produk.reduce((r,t)=>{const p=parseFloat(t.harga)||0,l=parseFloat(t.quantity)||0;return r+p*l},0);n("total",e)},[s.produk]);const j=s.total*.11,Q=s.total+j;return a.jsx(ea,{children:a.jsxs($,{defaultValue:"datatable",className:"w-full",children:[a.jsxs(aa,{className:"grid w-full grid-cols-2",children:[a.jsx(k,{value:"datatable",children:"Data Table"}),a.jsx(k,{value:"form",children:"Tambah Data"})]}),a.jsx(f,{value:"datatable",children:(c==null?void 0:c.user)&&a.jsx(ta,{columns:ra,data:N})}),a.jsx(f,{value:"form",children:a.jsx(W,{children:a.jsxs("form",{onSubmit:H,children:[a.jsxs(X,{children:[a.jsx(Z,{children:"Tambah Laporan Pembelian"}),a.jsx(z,{children:"Masukkan data pembelian produk."})]}),a.jsxs(U,{className:"space-y-4",children:[a.jsxs("div",{className:"space-y-1",children:[a.jsx(o,{children:"Tanggal Pembelian"}),a.jsxs("div",{className:"space-y-1",children:[a.jsx(o,{children:"Tanggal & Waktu Pembelian"}),a.jsx(i,{type:"datetime-local",value:na(s.tgl_pembelian,"yyyy-MM-dd'T'HH:mm"),onChange:e=>{const r=new Date(e.target.value);n("tgl_pembelian",r)}})]})]}),a.jsxs("div",{className:"flex flex-col gap-2",children:[a.jsx(o,{children:"Nama Supplier"}),a.jsx(_,{options:F,value:s.supplier_id,onValueChange:e=>n("supplier_id",e),placeholder:"Pilih Supplier",searchPlaceholder:"Cari supplier..."})]}),s.produk.map((e,r)=>a.jsxs("div",{className:"flex gap-2 items-end",children:[a.jsx(_,{options:B,value:e.produk_id,onValueChange:t=>q(r,{value:t}),placeholder:"Pilih Produk",searchPlaceholder:"Cari produk..."}),a.jsx(i,{type:"text",placeholder:"Harga",className:"w-32",value:E(e.harga),onChange:t=>M(r,G(t.target.value))}),a.jsx(i,{type:"number",placeholder:"Qty",className:"w-24",value:e.quantity,onChange:t=>V(r,t.target.value)}),a.jsx(x,{variant:"destructive",type:"button",onClick:()=>A(r),disabled:s.produk.length===1,children:"Hapus"})]},r)),a.jsx(x,{type:"button",variant:"secondary",onClick:O,children:"+ Tambah Produk"}),a.jsxs("div",{className:"space-y-1",children:[a.jsx(o,{children:"Sub Total"}),a.jsx(i,{type:"text",value:u(s.total),readOnly:!0})]}),a.jsxs("div",{className:"space-y-1",children:[a.jsx(o,{children:"PPN 11%"}),a.jsx(i,{type:"text",value:u(j),readOnly:!0})]}),a.jsxs("div",{className:"space-y-1",children:[a.jsx(o,{children:"Grand Total"}),a.jsx(i,{type:"text",value:u(Q),readOnly:!0})]}),a.jsxs("div",{children:[a.jsx(o,{className:"mb-1 block",children:"Keterangan Pembayaran"}),a.jsxs(v,{value:s.keterangan,onValueChange:e=>n("keterangan",e),children:[a.jsx(C,{className:"w-[200px]",children:a.jsx(T,{placeholder:"Pilih keterangan"})}),a.jsxs(P,{children:[a.jsx(m,{value:"Lunas",children:"Lunas"}),a.jsx(m,{value:"Belum Lunas",children:"Belum Lunas"})]})]}),d.keterangan&&a.jsx("p",{className:"text-sm text-red-500",children:d.keterangan})]}),a.jsxs("div",{children:[a.jsx(o,{className:"mb-1 block",children:"Metode Pembayaran"}),a.jsxs(v,{value:s.metode_pembayaran,onValueChange:e=>n("metode_pembayaran",e),children:[a.jsx(C,{className:"w-[200px]",children:a.jsx(T,{placeholder:"Pilih metode pembayaran"})}),a.jsxs(P,{children:[a.jsx(m,{value:"Tunai",children:"Tunai"}),a.jsx(m,{value:"Transfer",children:"Transfer"})]})]}),d.metode_pembayaran&&a.jsx("p",{className:"text-sm text-red-500",children:d.metode_pembayaran})]})]}),a.jsx(Y,{children:a.jsx(x,{type:"submit",disabled:g,children:g?"Menyimpan...":"Simpan Laporan"})})]})})})]})})};export{Xa as default};
