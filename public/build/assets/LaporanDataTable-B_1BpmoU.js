import{r as i,j as e}from"./app-DMT2vBXn.js";import{u as H,g as _,a as z,b as P,c as I,f as S}from"./index-kG6c7UDx.js";import{u as h,w as Y}from"./xlsx-D1NZSDnX.js";import{T as E,a as B,b as p,c as G,d as L,e as N,r as $}from"./table-QZwdL8Va.js";import{B as m}from"./button-Ltm5HKdw.js";import{I as V}from"./input-Bhz1a6y8.js";import{C as R}from"./calendar-DBJVIiVd.js";import{b as K}from"./utils-DszqnmLP.js";import{S as O}from"./search-CXvWl5jx.js";function se({data:u,columns:g,excelName:f="laporan.xlsx",excelMap:j,getTotal:x}){const[w,b]=i.useState(""),[o,D]=i.useState(null),[r,v]=i.useState(null),[C,k]=i.useState(!1),c=i.useMemo(()=>{if(!o||!r)return u;const t=new Date(o.setHours(0,0,0,0)),s=new Date(r.setHours(23,59,59,999));return u.filter(a=>{const l=new Date(a.tgl_pesanan||a.tanggal);return l>=t&&l<=s})},[u,o,r]);console.log(u);const y=i.useMemo(()=>x?x(c):0,[c,x]),M=t=>{const s=new Date;let a,l;switch(t){case"today":a=new Date(s.setHours(0,0,0,0)),l=new Date(s.setHours(23,59,59,999));break;case"thisMonth":a=new Date(s.getFullYear(),s.getMonth(),1),l=new Date(s.getFullYear(),s.getMonth()+1,0);break;case"thisYear":a=new Date(s.getFullYear(),0,1),l=new Date(s.getFullYear(),11,31);break;case"last7Days":l=new Date,a=new Date,a.setDate(l.getDate()-6);break;default:a=l=s}D(a),v(l),k(!1)},F=()=>{const t=j?c.map(j):c,s=h.json_to_sheet(t),a=h.book_new();h.book_append_sheet(a,s,"Laporan");const l=T=>T.toISOString().split("T")[0];let d=f;o&&r&&(d=`${f.replace(".xlsx","")}_${l(o)}_sampai_${l(r)}.xlsx`),Y(a,d)},n=H({data:c,columns:g,state:{globalFilter:w},onGlobalFilterChange:b,filterFns:{fuzzy:(t,s,a,l)=>{const d=$(t.getValue(s),a);return l({itemRank:d}),d.passed}},getCoreRowModel:I(),getFilteredRowModel:P(),getPaginationRowModel:z(),getSortedRowModel:_()});return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[["today","thisMonth","thisYear","last7Days"].map(t=>e.jsx(m,{variant:"outline",onClick:()=>M(t),children:{today:"Hari Ini",thisMonth:"Bulan Ini",thisYear:"Tahun Ini",last7Days:"7 Hari Terakhir"}[t]},t)),e.jsx(m,{variant:"outline",onClick:()=>k(!C),children:"Rentang Kustom"}),e.jsxs("div",{className:"relative ml-auto",children:[e.jsx(V,{placeholder:"Cari...",value:w,onChange:t=>b(t.target.value),className:"pl-10"}),e.jsx(O,{className:"absolute left-3 top-2.5 h-4 w-4 text-muted-foreground"})]}),e.jsx(m,{onClick:F,children:"Ekspor Excel"})]}),C&&e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsxs("div",{children:[e.jsx("span",{className:"block text-sm",children:"Dari:"}),e.jsx(R,{mode:"single",selected:o??void 0,onSelect:t=>D(t??null)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"block text-sm",children:"Sampai:"}),e.jsx(R,{mode:"single",selected:r??void 0,onSelect:t=>v(t??null)})]})]}),e.jsx("div",{className:"rounded border",children:e.jsxs(E,{children:[e.jsx(B,{children:n.getHeaderGroups().map(t=>e.jsx(p,{children:t.headers.map(s=>e.jsx(G,{children:S(s.column.columnDef.header,s.getContext())},s.id))},t.id))}),e.jsx(L,{children:n.getRowModel().rows.length?n.getRowModel().rows.map(t=>e.jsx(p,{children:t.getVisibleCells().map(s=>e.jsx(N,{children:S(s.column.columnDef.cell,s.getContext())},s.id))},t.id)):e.jsx(p,{children:e.jsx(N,{colSpan:g.length,className:"text-center py-8",children:"Tidak ada data."})})})]})}),x&&e.jsx("div",{className:"flex justify-end items-center space-x-4 py-4",children:e.jsxs("div",{className:"text-sm font-semibold",children:["Total:"," ",e.jsx("span",{className:"text-green-600",children:K(y)})]})}),e.jsxs("div",{className:"flex items-center justify-end space-x-2 py-4",children:[e.jsx(m,{variant:"outline",size:"sm",onClick:()=>n.previousPage(),disabled:!n.getCanPreviousPage(),children:"Previous"}),e.jsx(m,{variant:"outline",size:"sm",onClick:()=>n.nextPage(),disabled:!n.getCanNextPage(),children:"Next"})]})]})}export{se as L};
