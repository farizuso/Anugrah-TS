import{X as R,G as F,r as v,j as a}from"./app-gbqRK6I6.js";import{B as c,a as L}from"./button-yffARQN3.js";import{c as O,C as A,a as E,b as G,d as Q,e as V}from"./card-u5Tioc61.js";import{I as p}from"./input-PqUgssO1.js";import{L as m}from"./label-Dl6HLva7.js";import{T as B,a as J,b as x,c as k}from"./tabs-CXPo1F2e.js";import{A as K}from"./AdminLayout-CJu3Uo7s.js";import{PesananColumns as X}from"./PesananColumn-DqLH1yfT.js";import{P as z,a as U,b as W,C}from"./CommandCombobox-UtYiMJ31.js";import{C as Y}from"./calendar-HaDQFjRj.js";import{D as Z}from"./DataTable-S1gZcizK.js";import{C as aa}from"./calendar-D-i7fIto.js";import{f as P}from"./id-VFStllgx.js";import"./index-BHfLfCAz.js";import"./index-DUaqigYS.js";import"./index-D_GOL74N.js";import"./index-CPTO_JcL.js";import"./index-Cnx-wDt4.js";import"./chevron-right-B7ByaAXo.js";import"./check-D5s7sOKl.js";import"./createLucideIcon-BQPeE-JP.js";import"./x-BmPXDhF2.js";import"./index-K1O0Mx3-.js";import"./checkbox-KHfeoOdh.js";import"./index-BArM0ceO.js";import"./Delete-BEvz45tk.js";import"./index-DbVHjbux.js";import"./iconBase-H9NHt7Ab.js";import"./Edit-BykaB4XK.js";import"./index-5M3u7x2O.js";import"./addMonths-MMVoVJT0.js";import"./search-DcZid4ht.js";import"./chevron-down-DRKS08j8.js";import"./arrow-up-down-DKH1XiZR.js";import"./eye-BIyiAEhr.js";import"./index-D5VoYkmI.js";import"./table-BE8wuwpn.js";const Oa=({posts:_,produks:g,pelanggans:w})=>{const h=R().props.auth,{data:l,setData:i,post:N,processing:y,reset:T}=F({tgl_pesanan:P(new Date,"yyyy-MM-dd"),pelanggan_id:"",produk:[{produk_id:"",quantity:0,harga:0,tipe_item:"jual",durasi:0}],total:0}),[j,d]=v.useState([]),S=w.map(e=>({value:String(e.id),label:e.nama_pelanggan})),D=g.map(e=>({value:String(e.id),label:e.nama_produk})),b=e=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR"}).format(e),q=(e,s)=>{const r=g.find(o=>String(o.id)===(s==null?void 0:s.value)),t=[...l.produk];if(t[e].produk_id=(s==null?void 0:s.value)||"",t[e].tipe_item==="sewa"&&(r==null?void 0:r.kategori)==="gas"){const o=(r==null?void 0:r.harga_jual)||0,u=1e5*(t[e].durasi||1);t[e].harga=o+u,t[e].durasi=1}else t[e].harga=(r==null?void 0:r.harga_jual)||0,t[e].durasi=0;i("produk",t);const n=[...j];n[e]=s,d(n)},I=(e,s)=>{const r=parseInt(s,10),t=[...l.produk];t[e].quantity=Number.isFinite(r)?r:0,i("produk",t)},$=()=>{i("produk",[...l.produk,{produk_id:"",quantity:0,harga:0,tipe_item:"jual",durasi:0}]),d([...j,null])},H=e=>{const s=[...l.produk];s.splice(e,1),i("produk",s);const r=[...j];r.splice(e,1),d(r)},M=e=>{e.preventDefault(),N(route("staffpenjualan.pesanan.store"),{data:l,preserveScroll:!0,onSuccess:()=>{T(),d([null]),i("produk",[{produk_id:"",quantity:0,harga:0,tipe_item:"jual",durasi:0}])}})};return v.useEffect(()=>{console.log("=== Kalkulasi Total ==="),l.produk.forEach((s,r)=>{console.log(`Item ${r}: harga=${s.harga}, quantity=${s.quantity}`)});const e=l.produk.reduce((s,r)=>{const t=Number(r.quantity),n=Number(r.harga),o=Number.isFinite(t)?t:0,u=Number.isFinite(n)?n:0;return console.log(`Qty: ${o}, Harga: ${u}, Subtotal: ${u*o}`),s+u*o},0);console.log("TOTAL:",e),i("total",e)},[l.produk]),a.jsx(K,{children:a.jsxs(B,{defaultValue:"datatable",className:"w-full",children:[a.jsxs(J,{className:"grid w-full grid-cols-2",children:[a.jsx(x,{value:"datatable",children:"Data Table"}),a.jsx(x,{value:"form",children:"Tambah Data"})]}),a.jsx(k,{value:"datatable",children:(h==null?void 0:h.user)&&a.jsx(Z,{columns:X,data:_})}),a.jsx(k,{value:"form",children:a.jsx(O,{children:a.jsxs("form",{onSubmit:M,children:[a.jsxs(A,{children:[a.jsx(E,{children:"Tambah Pesanan"}),a.jsx(G,{children:"Masukkan data Pesanan."})]}),a.jsxs(Q,{className:"space-y-4",children:[a.jsxs("div",{className:"space-y-1",children:[a.jsx(m,{children:"Tanggal Pemesanan"}),a.jsxs(z,{children:[a.jsx(U,{asChild:!0,children:a.jsxs(c,{variant:"outline",className:L("w-full justify-start text-left font-normal",!l.tgl_pesanan&&"text-muted-foreground"),children:[l.tgl_pesanan??"Pilih Tanggal",a.jsx(aa,{className:"ml-auto h-4 w-4 opacity-50"})]})}),a.jsx(W,{className:"w-auto p-0",children:a.jsx(Y,{mode:"single",selected:l.tgl_pesanan?new Date(l.tgl_pesanan):void 0,onSelect:e=>{if(e){const s=P(e,"yyyy-MM-dd");i("tgl_pesanan",s)}}})})]})]}),a.jsxs("div",{className:"flex flex-col gap-2",children:[a.jsx(m,{children:"Nama Pelanggan"}),a.jsx(C,{options:S,value:l.pelanggan_id,onValueChange:e=>i("pelanggan_id",e),placeholder:"Pilih Pelanggan",searchPlaceholder:"Cari Pelanggan..."})]}),a.jsxs("div",{children:[a.jsx(m,{children:"Produk"}),l.produk.map((e,s)=>{const r=g.find(t=>String(t.id)===e.produk_id);return a.jsxs("div",{className:"flex gap-2 items-center mb-2",children:[a.jsx(C,{options:D,value:e.produk_id,onValueChange:t=>q(s,{value:t}),placeholder:"Pilih Produk",searchPlaceholder:"Cari produk..."}),a.jsxs("select",{className:"border rounded px-2 py-1",value:e.tipe_item,onChange:t=>{const n=t.target.value,o=[...l.produk];if(o[s].tipe_item=n,n==="sewa"&&(r==null?void 0:r.kategori)==="gas"){const u=(r==null?void 0:r.harga_jual)||0,f=1e5*(o[s].durasi||1);o[s].harga=u+f,o[s].durasi=1}else o[s].harga=(r==null?void 0:r.harga_jual)||0,o[s].durasi=0;i("produk",o)},children:[a.jsx("option",{value:"jual",children:"Jual"}),a.jsx("option",{value:"sewa",children:"Sewa"})]}),e.tipe_item==="sewa"&&a.jsx(p,{type:"number",placeholder:"Durasi (bln)",className:"w-28",value:e.durasi,onChange:t=>{const n=parseInt(t.target.value)||1,o=[...l.produk];o[s].durasi=n;const u=(r==null?void 0:r.harga_jual)||0,f=1e5*n;o[s].harga=u+Number(f),i("produk",o)}}),a.jsx(p,{type:"text",placeholder:"Harga",className:"w-32",value:b(Number(e.harga)),readOnly:!0}),a.jsx(p,{type:"number",placeholder:"Qty",className:"w-24",value:e.quantity,onChange:t=>I(s,t.target.value)}),a.jsx(c,{variant:"destructive",type:"button",onClick:()=>H(s),disabled:l.produk.length===1,children:"Hapus"})]},s)}),a.jsx(c,{type:"button",variant:"secondary",onClick:$,children:"+ Tambah Produk"}),a.jsxs("div",{className:"space-y-1 mt-4",children:[a.jsx(m,{children:"Total"}),a.jsx(p,{type:"text",value:b(l.total),readOnly:!0})]})]})]}),a.jsx(V,{children:a.jsx(c,{type:"submit",disabled:y,children:y?"Menyimpan...":"Simpan Pesanan"})})]})})})]})})};export{Oa as default};
