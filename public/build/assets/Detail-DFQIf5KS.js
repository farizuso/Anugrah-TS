import{G as N,j as e,r as _,A as p}from"./app-D1nQb4Pq.js";import{B as k,A as w}from"./AdminLayout-BCyMsH8b.js";import{B as h,f as m}from"./button-Cm6AfoYt.js";import{L as b}from"./label-ZtP4Bqmb.js";import{S as v,a as S,b as D,c as T,d as j}from"./select-ChX_0VXg.js";import{I as f}from"./input-CLyAqGj_.js";import{f as g}from"./id-VFStllgx.js";import{a as I}from"./addMonths-MMVoVJT0.js";import"./index-BBjeM96p.js";import"./index-B7kqKusm.js";import"./index-CGqlSRWA.js";import"./index-fdiJIneU.js";import"./index-CCbLHtIO.js";import"./chevron-right-o5EJqoYd.js";import"./check-B5wHYp00.js";import"./createLucideIcon-UMoRt27w.js";import"./x-D2yeMw6N.js";import"./index-BqI_ERgH.js";import"./index--_4n9zKo.js";import"./chevron-down-B7GGlQ81.js";const M=({pesananId:a,sisaTagihan:i})=>{const{data:t,setData:o,post:n,processing:d,reset:u,errors:c}=N({jumlah_terbayar:0,bukti_transfer:null}),s=l=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(l),x=l=>{if(l.preventDefault(),t.jumlah_terbayar>i){k.error("Jumlah pembayaran melebihi sisa tagihan.");return}const r=new FormData;r.append("jumlah_terbayar",String(t.jumlah_terbayar)),t.bukti_transfer&&r.append("bukti_transfer",t.bukti_transfer),n(route("staffpenjualan.pesanan.konfirmasi_pembayaran",a),{data:r,forceFormData:!0,onSuccess:()=>u()})};return e.jsxs("form",{onSubmit:x,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(b,{children:"Jumlah Pembayaran"}),e.jsx(f,{type:"text",value:s(t.jumlah_terbayar),onChange:l=>{const r=l.target.value.replace(/[^\d]/g,""),y=parseInt(r||"0");o("jumlah_terbayar",y)}}),c.jumlah_terbayar&&e.jsx("p",{className:"text-sm text-red-500",children:c.jumlah_terbayar})]}),e.jsxs("div",{children:[e.jsx(b,{children:"Bukti Transfer (Opsional)"}),e.jsx(f,{type:"file",onChange:l=>{var r;return o("bukti_transfer",((r=l.target.files)==null?void 0:r[0])||null)}}),c.bukti_transfer&&e.jsx("p",{className:"text-sm text-red-500",children:c.bukti_transfer})]}),e.jsx(h,{type:"submit",disabled:d,children:d?"Menyimpan...":"Konfirmasi Pembayaran"})]})},P=a=>{const i=a.tipe_item==="sewa"?1e5*a.durasi:0;return{hargaGas:a.harga-i,hargaSewa:i}},C=a=>a.details.some(i=>i.tipe_item==="sewa"),B=a=>{const i=a.details.filter(n=>n.tipe_item==="sewa").reduce((n,d)=>n+(parseInt(String(d.durasi))||0),0),t=new Date(a.tgl_pesanan),o=I(t,i);return`${g(t,"dd MMM yyyy")} - ${g(o,"dd MMM yyyy")}`},ee=({pesanan:a})=>{var n,d,u,c;const[i,t]=_.useState(!1),o=s=>{a.metode_pembayaran||p.post(route("staffpenjualan.pesanan.update_pembayaran",a.id),{metode_pembayaran:s},{preserveScroll:!0})};return e.jsxs(w,{children:[e.jsxs("div",{className:"bg-blue-700 text-white px-6 py-4 rounded-t-md",children:[e.jsx("h2",{className:"text-2xl font-semibold",children:"Detail Transaksi"}),e.jsxs("p",{className:"text-sm mt-1",children:["Nomor Invoice:"," ",e.jsx("strong",{children:a.nomor_invoice||`#${a.id}`})]})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold mb-1",children:"Informasi Pemesanan"}),e.jsxs("p",{children:["Tanggal pesanan:"," ",e.jsx("strong",{children:g(new Date(a.tgl_pesanan),"dd MMM yyyy")})]}),e.jsxs("p",{children:["Metode pembayaran:"," ",e.jsx("strong",{children:a.metode_pembayaran||"-"})]}),e.jsxs("p",{children:["Status pembayaran:"," ",e.jsx("strong",{className:"capitalize",children:a.keterangan})]}),e.jsxs("p",{children:["Status pengiriman:"," ",e.jsx("strong",{className:"capitalize",children:a.status||"-"})]}),C(a)&&e.jsxs("div",{className:"mt-3 bg-yellow-100 border-l-4 border-yellow-500 text-yellow-800 p-3 rounded",children:[e.jsxs("p",{className:"font-semibold",children:["🛢️ Pesanan ini mengandung"," ",e.jsx("span",{className:"underline",children:"Sewa Tabung"}),"."]}),e.jsxs("p",{children:["Masa sewa:"," ",e.jsx("strong",{children:B(a)})]}),e.jsxs("p",{children:["Biaya sewa: ",e.jsx("strong",{children:"Rp100.000/bulan"})," ","(belum termasuk isi gas)"]})]}),a.keterangan==="Cicilan"&&e.jsxs("p",{className:"text-orange-600 mt-1",children:["Sisa tagihan:"," ",e.jsx("strong",{children:m(a.total-a.jumlah_terbayar)})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold mb-1",children:"Informasi Pengiriman"}),e.jsxs("p",{children:["Penerima:"," ",e.jsx("strong",{children:((n=a.pelanggan)==null?void 0:n.nama_pelanggan)||"-"})]}),e.jsxs("p",{children:["Alamat:"," ",e.jsx("strong",{children:((d=a.pelanggan)==null?void 0:d.alamat)||"-"})]}),e.jsxs("p",{children:["No. Telp:"," ",e.jsx("strong",{children:((u=a.pelanggan)==null?void 0:u.no_hp)||"-"})]})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border text-sm",children:[e.jsx("thead",{className:"bg-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left px-4 py-2",children:"Produk"}),e.jsx("th",{className:"text-left px-4 py-2",children:"Tipe"}),e.jsx("th",{className:"text-left px-4 py-2",children:"Masa Sewa"}),e.jsx("th",{className:"text-left px-4 py-2",children:"Jumlah"}),e.jsx("th",{className:"text-left px-4 py-2",children:"Harga/unit"}),e.jsx("th",{className:"text-left px-4 py-2",children:"Subtotal"})]})}),e.jsxs("tbody",{children:[a.details.map((s,x)=>{var r;const{hargaGas:l}=P(s);return e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"px-4 py-2",children:(r=s.produk)==null?void 0:r.nama_produk}),e.jsx("td",{className:"px-4 py-2 capitalize",children:s.tipe_item}),e.jsx("td",{className:"px-4 py-2",children:s.tipe_item==="sewa"?`${s.durasi} bln`:"-"}),e.jsxs("td",{className:"px-4 py-2",children:[s.quantity," tabung"]}),e.jsx("td",{className:"px-4 py-2",children:s.tipe_item==="sewa"?e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{children:["Sewa:"," ",m(1e5)," x"," ",s.quantity]}),e.jsxs("div",{children:["Gas:"," ",m(l)," x"," ",s.quantity]})]}):m(s.harga)}),e.jsx("td",{className:"px-4 py-2",children:m(s.harga*s.quantity)})]},x)}),e.jsxs("tr",{className:"font-bold border-t bg-gray-100",children:[e.jsx("td",{className:"px-4 py-2",colSpan:5,children:"Total"}),e.jsx("td",{className:"px-4 py-2 text-blue-700",children:m(a.total)})]})]})]})}),e.jsxs("div",{children:[e.jsx(b,{className:"mb-1 block",children:"Pilih Metode Pembayaran"}),e.jsxs(v,{defaultValue:a.metode_pembayaran||"",onValueChange:o,disabled:!!a.metode_pembayaran,children:[e.jsx(S,{className:"w-[200px]",children:e.jsx(D,{placeholder:"Pilih metode"})}),e.jsxs(T,{children:[e.jsx(j,{value:"tunai",children:"Tunai"}),e.jsx(j,{value:"transfer",children:"Transfer"}),e.jsx(j,{value:"cicilan",children:"Cicilan"})]})]})]}),e.jsxs("div",{className:"flex gap-3 flex-row mt-4",children:[e.jsx(h,{onClick:()=>window.open(route("staffpenjualan.invoice.pdf",a.id),"_blank"),children:"Cetak Invoice"}),e.jsx(h,{onClick:()=>window.open(route("staffpenjualan.tandaTerima.kosong",a.id),"_blank"),children:"Cetak Tanda Terima Tabung"}),a.status==="Dikirim"&&e.jsx(h,{variant:"success",onClick:()=>p.post(route("staffpenjualan.pesanan.selesai",a.id)),children:"Tandai Selesai"}),a.status==="Pending"&&e.jsx(h,{variant:"default",onClick:()=>p.post(route("staffpenjualan.pesanan.kirim",a.id)),children:"Konfirmasi Pengiriman"})]}),a.keterangan!=="Lunas"&&e.jsxs("div",{className:"pt-4 border-t",children:[e.jsx("p",{className:"text-red-600 mb-2",children:"Status: Belum Lunas"}),e.jsx(M,{pesananId:a.id,sisaTagihan:a.total-a.jumlah_terbayar})]}),((c=a.riwayat_pembayaran)==null?void 0:c.length)>0&&e.jsxs("div",{className:"mt-6 pt-4 border-t",children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Riwayat Pembayaran"}),e.jsx("ul",{className:"space-y-2",children:a.riwayat_pembayaran.map((s,x)=>e.jsxs("li",{className:"border p-3 rounded bg-gray-50 text-sm",children:[e.jsxs("div",{children:[e.jsxs("strong",{children:["Rp"," ",Number(s.jumlah_bayar).toLocaleString("id-ID")]})," ","-"," ",new Date(s.created_at).toLocaleDateString("id-ID")]}),s.bukti_transfer&&e.jsxs("div",{className:"mt-1",children:[e.jsx("a",{href:`/storage/${s.bukti_transfer}`,target:"_blank",className:"text-blue-600 hover:underline",children:"Lihat Bukti Transfer"}),s.bukti_transfer.endsWith(".pdf")?e.jsx("iframe",{src:`/storage/${s.bukti_transfer}`,className:"w-full h-64 mt-2 border rounded"}):e.jsx("img",{src:`/storage/${s.bukti_transfer}`,alt:"Bukti Transfer",className:"mt-2 max-w-xs rounded border"})]})]},x))})]})]})]})};export{ee as default};
