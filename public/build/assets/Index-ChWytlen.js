import{r as p,j as e,X as K,G as $}from"./app-Dii7zqnW.js";import{B as h,a as J}from"./button-BsQjze1b.js";import{c as X,C as U,a as W,b as Z,d as ee,e as ae}from"./card-DAVCSgTf.js";import{I as T}from"./input-CHyct-zY.js";import{L as P}from"./label-CGFWujJ7.js";import{T as te,a as se,b as Y,c as V}from"./tabs-CCPDKCyc.js";import{A as re}from"./AdminLayout-oQemvqRI.js";import{PembelianColumns as le}from"./PembelianColumn-DqYMGWI-.js";import{P as ne,a as oe,b as ie,C as B}from"./CommandCombobox-BgqdsATI.js";import{C as E}from"./calendar-DaEAHt3l.js";import{u as de,g as ce,a as ue,b as pe,c as me,f as Q}from"./index-HYzn0whZ.js";import{u as H,w as he}from"./xlsx-D1NZSDnX.js";import{T as ge,a as xe,b as L,c as be,d as je,e as G,r as fe}from"./table-DD6YWwhg.js";import{S as ke}from"./search-C_BslpFl.js";import{S as ye,a as we,b as ve,c as Ce,d as O}from"./select-C4vC72Zf.js";import{C as De}from"./calendar-BiPQVXAi.js";import{f as A}from"./id-VFStllgx.js";import"./index-B5o_9Tbb.js";import"./index-rNmJBksz.js";import"./index-CgvXscS3.js";import"./index-D5h-nBjq.js";import"./index-DJREYP7h.js";import"./chevron-right-H0JFxo7z.js";import"./check-CKUAekOC.js";import"./createLucideIcon-CgDtyGi8.js";import"./x-C_N1bMqv.js";import"./index-CfUBnOF0.js";import"./checkbox-D1yeP3xQ.js";import"./index-DxFg0HL1.js";import"./Delete-Cl7CWErd.js";import"./index-DheF0MJo.js";import"./iconBase-CtSaVPHs.js";import"./Edit-B49HhAx8.js";import"./index-zcADi2sy.js";import"./arrow-up-down-MT6xc3C4.js";import"./chevron-down-BkjwlUB1.js";import"./addMonths-MMVoVJT0.js";function Se({data:j,columns:v}){const[C,_]=p.useState(""),[c,o]=p.useState(null),[d,D]=p.useState(null),[f,k]=p.useState(!1),g=p.useMemo(()=>{if(!c||!d)return j;const t=new Date(c.setHours(0,0,0,0)),s=new Date(d.setHours(23,59,59,999));return j.filter(n=>{const r=new Date(n.tgl_pembelian);return r>=t&&r<=s})},[j,c,d]),R=p.useMemo(()=>g.reduce((t,s)=>{var n;return(n=s.details)==null||n.forEach(r=>{t+=r.harga*r.quantity}),t},0),[g]),q=p.useMemo(()=>g.reduce((t,s)=>{var n;return(n=s.details)==null||n.forEach(r=>{t+=r.quantity}),t},0),[g]),M=t=>{const s=new Date;let n,r;switch(t){case"today":n=new Date(s.setHours(0,0,0,0)),r=new Date,r.setHours(23,59,59,999);break;case"thisMonth":n=new Date(s.getFullYear(),s.getMonth(),1),r=new Date(s.getFullYear(),s.getMonth()+1,0);break;case"thisYear":n=new Date(s.getFullYear(),0,1),r=new Date(s.getFullYear(),11,31);break;case"last7Days":r=new Date,n=new Date,n.setDate(r.getDate()-6);break;default:n=r=s}o(n),D(r),k(!1)},F=()=>{const t=[];g.forEach(u=>{(u.details||[]).forEach(y=>{var S,N;t.push({"Tanggal Pembelian":new Date(u.tgl_pembelian).toLocaleDateString("id-ID"),"Nama Supplier":((S=u.supplier)==null?void 0:S.nama_supplier)??"-","Nama Produk":((N=y.produk)==null?void 0:N.nama_produk)??"-",QTY:y.quantity,"Harga Satuan":new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR"}).format(y.harga),"Total Harga":new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR"}).format(u.total),Keterangan:u.keterangan??"-",Status:u.status??"-"})})});const s=H.json_to_sheet(t),n=H.book_new();H.book_append_sheet(n,s,"Laporan Pembelian");const r=u=>u.toISOString().split("T")[0];let b="laporan_pembelian.xlsx";c&&d&&(b=`laporan_pembelian_${r(c)}_sampai_${r(d)}.xlsx`),he(n,b)},m=de({data:g,columns:v,state:{globalFilter:C},onGlobalFilterChange:_,filterFns:{fuzzy:(t,s,n,r)=>{const b=fe(t.getValue(s),n);return r({itemRank:b}),b.passed}},getCoreRowModel:me(),getFilteredRowModel:pe(),getPaginationRowModel:ue(),getSortedRowModel:ce()});return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[["today","thisMonth","thisYear","last7Days"].map(t=>e.jsx(h,{variant:"outline",onClick:()=>M(t),children:{today:"Hari Ini",thisMonth:"Bulan Ini",thisYear:"Tahun Ini",last7Days:"7 Hari Terakhir"}[t]},t)),e.jsx(h,{variant:"outline",onClick:()=>k(!f),children:"Rentang Kustom"}),e.jsxs("div",{className:"relative ml-auto",children:[e.jsx(T,{placeholder:"Cari...",value:C,onChange:t=>_(t.target.value),className:"pl-10"}),e.jsx(ke,{className:"absolute left-3 top-2.5 h-4 w-4 text-muted-foreground"})]}),e.jsx(h,{onClick:F,children:"Ekspor Excel"})]}),f&&e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsxs("div",{children:[e.jsx("span",{className:"block text-sm",children:"Dari:"}),e.jsx(E,{mode:"single",selected:c??void 0,onSelect:t=>o(t??null)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"block text-sm",children:"Sampai:"}),e.jsx(E,{mode:"single",selected:d??void 0,onSelect:t=>D(t??null)})]})]}),e.jsx("div",{className:"rounded border",children:e.jsxs(ge,{children:[e.jsx(xe,{children:m.getHeaderGroups().map(t=>e.jsx(L,{children:t.headers.map(s=>e.jsx(be,{children:Q(s.column.columnDef.header,s.getContext())},s.id))},t.id))}),e.jsx(je,{children:m.getRowModel().rows.length?m.getRowModel().rows.map(t=>e.jsx(L,{children:t.getVisibleCells().map(s=>e.jsx(G,{children:Q(s.column.columnDef.cell,s.getContext())},s.id))},t.id)):e.jsx(L,{children:e.jsx(G,{colSpan:v.length,className:"text-center py-8",children:"Tidak ada data."})})})]})}),e.jsxs("div",{className:"flex justify-end items-center space-x-4 py-4",children:[e.jsxs("div",{className:"text-sm",children:[e.jsx("strong",{children:"Total Jumlah Pembelian:"})," ",q," ","Produk"]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("strong",{children:"Total Harga:"})," Rp"," ",R.toLocaleString()]})]}),e.jsxs("div",{className:"flex items-center justify-end space-x-2 py-4",children:[e.jsx(h,{variant:"outline",size:"sm",onClick:()=>m.previousPage(),disabled:!m.getCanPreviousPage(),children:"Previous"}),e.jsx(h,{variant:"outline",size:"sm",onClick:()=>m.nextPage(),disabled:!m.getCanNextPage(),children:"Next"})]})]})}const ua=({posts:j,produks:v,suppliers:C})=>{const c=K().props.auth,{data:o,setData:d,post:D,processing:f,errors:k,reset:g}=$({tgl_pembelian:new Date,supplier_id:"",produk:[{produk_id:"",harga:"",quantity:""}],total:0,keterangan:"",status:""}),R=a=>{a.preventDefault();const i=A(o.tgl_pembelian,"yyyy-MM-dd");D(route("admin.laporanpembelian.store"),{data:{...o,tgl_pembelian:i},onSuccess:()=>{g(),d({tgl_pembelian:new Date,supplier_id:"",produk:[{produk_id:"",harga:"",quantity:""}],total:0,keterangan:"",status:""}),M(null),I([null])}})},[q,M]=p.useState(null),[F,I]=p.useState([null]),m=(a,i)=>{const l=[...o.produk];l[a].produk_id=(i==null?void 0:i.value)||"",d("produk",l)},t=(a,i)=>{const l=[...o.produk];l[a].harga=i,d("produk",l)},s=(a,i)=>{const l=[...o.produk];l[a].quantity=i,d("produk",l)},n=()=>{d("produk",[...o.produk,{produk_id:"",harga:"",quantity:""}]),I([...F,null])},r=a=>{const i=[...o.produk];i.splice(a,1),d("produk",i)},b=v.map(a=>({value:String(a.id),label:a.nama_produk})),u=C.map(a=>({value:String(a.id),label:a.nama_supplier})),y=a=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR"}).format(a),S=a=>{const l=a.replace(/[^,\d]/g,"").split(",");let w=l[0].length%3,x=l[0].substr(0,w);const z=l[0].substr(w).match(/\d{3}/gi);return z&&(x+=(w?".":"")+z.join(".")),x=l[1]!==void 0?x+","+l[1]:x,x?"Rp "+x:""},N=a=>a.replace(/[^0-9]/g,"");return p.useEffect(()=>{const a=o.produk.reduce((i,l)=>{const w=parseFloat(l.harga)||0,x=parseFloat(l.quantity)||0;return i+w*x},0);d("total",a)},[o.produk]),e.jsx(re,{children:e.jsxs(te,{defaultValue:"datatable",className:"w-full",children:[e.jsxs(se,{className:"grid w-full grid-cols-2",children:[e.jsx(Y,{value:"datatable",children:"Data Table"}),e.jsx(Y,{value:"form",children:"Tambah Data"})]}),e.jsx(V,{value:"datatable",children:(c==null?void 0:c.user)&&e.jsx(Se,{columns:le,data:j})}),e.jsx(V,{value:"form",children:e.jsx(X,{children:e.jsxs("form",{onSubmit:R,children:[e.jsxs(U,{children:[e.jsx(W,{children:"Tambah Laporan Pembelian"}),e.jsx(Z,{children:"Masukkan data pembelian produk."})]}),e.jsxs(ee,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(P,{children:"Tanggal Pembelian"}),e.jsxs(ne,{children:[e.jsx(oe,{asChild:!0,children:e.jsxs(h,{variant:"outline",className:J("w-full justify-start text-left font-normal",!o.tgl_pembelian&&"text-muted-foreground"),children:[o.tgl_pembelian?A(o.tgl_pembelian,"yyyy-MM-dd"):"Pilih Tanggal",e.jsx(De,{className:"ml-auto h-4 w-4 opacity-50"})]})}),e.jsx(ie,{className:"w-auto p-0",children:e.jsx(E,{mode:"single",selected:o.tgl_pembelian,onSelect:a=>{a&&d("tgl_pembelian",a)}})})]})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(P,{children:"Nama Supplier"}),e.jsx(B,{options:u,value:o.supplier_id,onValueChange:a=>d("supplier_id",a),placeholder:"Pilih Supplier",searchPlaceholder:"Cari supplier..."})]}),o.produk.map((a,i)=>e.jsxs("div",{className:"flex gap-2 items-end",children:[e.jsx(B,{options:b,value:a.produk_id,onValueChange:l=>m(i,{value:l}),placeholder:"Pilih Produk",searchPlaceholder:"Cari produk..."}),e.jsx(T,{type:"text",placeholder:"Harga",className:"w-32",value:S(a.harga),onChange:l=>t(i,N(l.target.value))}),e.jsx(T,{type:"number",placeholder:"Qty",className:"w-24",value:a.quantity,onChange:l=>s(i,l.target.value)}),e.jsx(h,{variant:"destructive",type:"button",onClick:()=>r(i),disabled:o.produk.length===1,children:"Hapus"})]},i)),e.jsx(h,{type:"button",variant:"secondary",onClick:n,children:"+ Tambah Produk"}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(P,{children:"Total"}),e.jsx(T,{type:"text",value:y(o.total),readOnly:!0})]}),e.jsxs("div",{children:[e.jsx(P,{className:"mb-1 block",children:"Keterangan Pembayaran"}),e.jsxs(ye,{value:o.keterangan,onValueChange:a=>d("keterangan",a),children:[e.jsx(we,{className:"w-[200px]",children:e.jsx(ve,{placeholder:"Pilih keterangan"})}),e.jsxs(Ce,{children:[e.jsx(O,{value:"Lunas",children:"Lunas"}),e.jsx(O,{value:"Belum Lunas",children:"Belum Lunas"})]})]}),k.keterangan&&e.jsx("p",{className:"text-sm text-red-500",children:k.keterangan})]})]}),e.jsx(ae,{children:e.jsx(h,{type:"submit",disabled:f,children:f?"Menyimpan...":"Simpan Laporan"})})]})})})]})})};export{ua as default};
