import{r as f,X as R,G as E,j as e}from"./app-D1nQb4Pq.js";import{B as d,a as F}from"./button-Cm6AfoYt.js";import{D as B,a as G,B as H,b as M,c as L,d as Q,e as V,f as z}from"./index-DDvUusoZ.js";import{I as c}from"./input-CLyAqGj_.js";import{L as g}from"./label-ZtP4Bqmb.js";import{C as A}from"./calendar-CT2TSpWQ.js";import{P as J,a as X,b as $,C as k}from"./CommandCombobox-CQMeH9S-.js";import{C as K}from"./calendar-DDvV_uX9.js";import{f as U}from"./id-VFStllgx.js";import"./index-CCbLHtIO.js";import"./index-BBjeM96p.js";import"./index-B7kqKusm.js";import"./index-CGqlSRWA.js";import"./x-D2yeMw6N.js";import"./createLucideIcon-UMoRt27w.js";import"./iconBase-DMxPhWqd.js";import"./addMonths-MMVoVJT0.js";import"./chevron-right-o5EJqoYd.js";import"./check-B5wHYp00.js";import"./search-BOn3zuNT.js";import"./chevron-down-B7GGlQ81.js";const ka=({pesananedit:u})=>{const[x,h]=f.useState(!1),{produks:p=[],pelanggans:_=[]}=R().props,v=p.map(a=>({value:String(a.id),label:a.nama_produk})),y=_.map(a=>({value:String(a.id),label:a.nama_pelanggan})),{data:t,setData:l,put:b,processing:m,reset:w}=E({tgl_pesanan:u.tgl_pesanan?new Date(u.tgl_pesanan):new Date,pelanggan_id:String(u.pelanggan.id)||"",produk:u.details.map(a=>({produk_id:String(a.produk.id),harga:String(a.harga),quantity:String(a.quantity),tipe_item:a.tipe_item||"jual",durasi:a.durasi||0})),keterangan:u.keterangan||"",total:u.total||0}),j=a=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR"}).format(a);f.useEffect(()=>{const a=t.produk.reduce((s,r)=>{const n=parseFloat(r.harga)||0,o=parseFloat(r.quantity)||0;return s+n*o},0);l("total",a)},[t.produk]);const S=(a,s)=>{const r=[...t.produk];if(s){r[a].produk_id=s.value;const n=p.find(o=>String(o.id)===s.value);if(n){const o=n.harga_jual||0;if(r[a].tipe_item==="sewa"){const i=r[a].durasi||1;r[a].harga=String(o+1e5*i)}else r[a].harga=String(o)}}else r[a].produk_id="",r[a].harga="";l("produk",r)},C=(a,s)=>{const r=[...t.produk];r[a].quantity=s,l("produk",r)},P=(a,s)=>{const r=[...t.produk];r[a].tipe_item=s;const n=p.find(i=>String(i.id)===r[a].produk_id),o=(n==null?void 0:n.harga_jual)||0;if(s==="sewa"){const i=r[a].durasi||1;r[a].harga=String(o+1e5*i),r[a].durasi=i}else r[a].harga=String(o),r[a].durasi=0;l("produk",r)},D=(a,s)=>{const r=parseInt(s)||1,n=[...t.produk];n[a].durasi=r;const o=p.find(O=>String(O.id)===n[a].produk_id),i=(o==null?void 0:o.harga_jual)||0;n[a].harga=String(i+1e5*r),l("produk",n)},N=()=>{l("produk",[...t.produk,{produk_id:"",harga:"",quantity:"",tipe_item:"jual",durasi:0}])},q=a=>{const s=[...t.produk];s.splice(a,1),l("produk",s)},T=a=>{a&&l("tgl_pesanan",a)},I=a=>{a.preventDefault(),b(route("staffpenjualan.pesanan.update",u.id),{data:{...t,tgl_pesanan:t.tgl_pesanan.toISOString()},onSuccess:()=>{w(),h(!1)}})};return e.jsxs(B,{open:x,onOpenChange:h,children:[e.jsx(G,{asChild:!0,children:e.jsx(d,{variant:"outline_blue",size:"sm",children:e.jsx(H,{})})}),e.jsxs(M,{className:"sm:max-w-3xl",children:[e.jsxs(L,{children:[e.jsx(Q,{children:"Edit Pesanan"}),e.jsx(V,{children:"Perbarui informasi pesanan di bawah ini."})]}),e.jsxs("form",{onSubmit:I,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{children:"Tanggal Pesanan"}),e.jsxs(J,{children:[e.jsx(X,{asChild:!0,children:e.jsxs(d,{variant:"outline",className:F("w-full justify-start text-left font-normal",!t.tgl_pesanan&&"text-muted-foreground"),children:[t.tgl_pesanan?U(t.tgl_pesanan,"yyyy-MM-dd"):"Pilih Tanggal",e.jsx(K,{className:"ml-auto h-4 w-4 opacity-50"})]})}),e.jsx($,{className:"w-auto p-0",children:e.jsx(A,{mode:"single",selected:t.tgl_pesanan,onSelect:T,initialFocus:!0})})]})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(g,{children:"Nama Pelanggan"}),e.jsx(k,{options:y,value:t.pelanggan_id,onValueChange:a=>l("pelanggan_id",a),placeholder:"Pilih Supplier",searchPlaceholder:"Cari Supplier..."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{children:"Produk"}),t.produk.map((a,s)=>e.jsxs("div",{className:"flex items-end gap-2 flex-wrap",children:[e.jsx("div",{className:"w-full sm:w-48",children:e.jsx(k,{options:v,value:a.produk_id,onValueChange:r=>S(s,{value:r}),placeholder:"Pilih Produk",searchPlaceholder:"Cari produk..."})}),e.jsxs("select",{className:"border rounded px-2 py-1",value:a.tipe_item,onChange:r=>P(s,r.target.value),children:[e.jsx("option",{value:"jual",children:"Jual"}),e.jsx("option",{value:"sewa",children:"Sewa"})]}),a.tipe_item==="sewa"&&e.jsx(c,{type:"number",placeholder:"Durasi (bln)",className:"w-28",value:a.durasi,onChange:r=>D(s,r.target.value)}),e.jsx(c,{type:"text",placeholder:"Harga",className:"w-32",value:j(Number(a.harga)),readOnly:!0}),e.jsx(c,{type:"number",className:"w-24",placeholder:"Qty",value:a.quantity,onChange:r=>C(s,r.target.value)}),e.jsx(d,{type:"button",variant:"destructive",onClick:()=>q(s),disabled:t.produk.length===1,children:"Hapus"})]},s)),e.jsx(d,{type:"button",variant:"secondary",onClick:N,children:"+ Tambah Produk"})]}),e.jsxs("div",{children:[e.jsx(g,{children:"Total"}),e.jsx(c,{value:j(t.total),disabled:!0})]}),e.jsx(z,{children:e.jsx(d,{type:"submit",disabled:m,children:m?"Menyimpan...":"Simpan Perubahan"})})]})]})]})};export{ka as default};
